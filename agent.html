<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>Atbalsta Aģents • Budžeta Plānošana</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="system-guard.css">
</head>
<body class="theme-dark cosmic-bg page-enter">
  <header class="topbar glass deep">
    <div class="brand">
      <svg width="30" height="30" viewBox="0 0 24 24" class="logo">
        <path fill="#00e5ff" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 15h-2v-2h2Zm0-4h-2a1 1 0 0 1-1-1 3 3 0 1 1 5-2h-2a1 1 0 1 0-2 0c0 .551.449 1 1 1a3 3 0 0 1 3 3 1 1 0 0 1-1 1Z"/>
      </svg>
      <h1>Atbalsta Panelis</h1>
    </div>
    <nav class="nav">
      <a href="agent.html" class="active">Aģents</a>
    </nav>
    <div class="userbox">
      <span id="userEmail"></span>
      <button id="logoutBtn" class="btn danger small">Izrakstīties</button>
    </div>
  </header>

  <main class="container wide with-footer">
    <section class="agent-wrap">
      <aside class="agent-sidebar glass">
        <div class="sidebar-header">
          <strong>Lietotāju čati</strong>
          <button id="refreshRooms" class="btn outline small">Atjaunot</button>
        </div>
        <input id="roomSearch" type="text" placeholder="Meklēt e-pastu..." class="full-row" />
        <div id="roomsList" class="rooms-list sleek-scroll"></div>

        <hr style="margin:16px 0; border-color:rgba(255,255,255,.12)">

        <strong>Ziņojumi (reports)</strong>
        <div id="reportsList" class="rooms-list sleek-scroll" style="max-height:260px;"></div>

        <hr style="margin:16px 0; border-color:rgba(255,255,255,.12)">

        <strong>Lietotāji (ar brīdinājumiem augšā)</strong>
        <div id="usersList" class="rooms-list sleek-scroll" style="max-height:260px;"></div>
      </aside>

      <section class="agent-main card glass elevate">
        <div id="maintenanceBanner" class="maintenance-banner" style="display:none;"></div>

        <div class="room-header">
          <div>
            <h2 id="currentRoomTitle">Nav izvēlēts čats</h2>
            <div id="roomMeta" class="muted small"></div>
          </div>
          <div class="room-tools">
            <button id="assignRoom" class="btn outline small" disabled>Piešķirt</button>
            <button id="toggleMaintenance" class="btn outline small">Maintenance</button>
            <button id="exportJSON" class="btn outline small" disabled>JSON</button>
            <button id="exportCSV" class="btn outline small" disabled>CSV</button>
            <button id="clearRoom" class="btn danger small" disabled>Clear</button>
          </div>
        </div>

        <div id="chatStatus" class="muted small">Izvēlies čatu.</div>
        <div id="chatMessages" class="chat-messages sleek-scroll"></div>

        <form id="chatForm" class="chat-form" style="display:none;">
          <input id="chatInput" type="text" placeholder="Ziņa..." autocomplete="off" required />
          <button type="submit" class="btn primary small">Sūtīt</button>
        </form>

        <div id="systemTools" style="display:none;">
          <h3>Sistēmas ziņa čatam</h3>
          <form id="systemForm" class="chat-form">
            <input id="systemInput" type="text" placeholder="Sistēmas paziņojums (šim čatam)..." autocomplete="off" required />
            <button type="submit" class="btn outline small">Raidīt</button>
          </form>
        </div>

        <br>
        <section class="card glass elevate" id="globalBroadcast">
          <h3>Globāls sistēmas paziņojums (visām lapām)</h3>
          <form id="broadcastForm" class="chat-form">
            <textarea id="broadcastMessage" placeholder="Ziņa visiem lietotājiem..." required rows="3"></textarea>
            <div class="row" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;">
              <select id="broadcastLevel">
                <option value="info">Info</option>
                <option value="warning">Brīdinājums</option>
                <option value="alert">ALERT</option>
              </select>
              <input type="number" id="broadcastMinutes" min="0" placeholder="Minūtes līdz iztec." style="width:160px;">
              <label style="display:flex;align-items:center;gap:6px;font-size:.9rem;">
                <input type="checkbox" id="broadcastDismissible" checked> Lietotājs var aizvērt
              </label>
            </div>
            <div style="margin-top:10px; display:flex; gap:10px;">
              <button type="submit" class="btn primary small">Publicēt</button>
              <button type="button" id="broadcastClear" class="btn danger small">Atslēgt</button>
            </div>
          </form>
        </section>

        <br>
        <section class="card glass elevate" id="reportActions" style="display:none;">
          <h3>Report details</h3>
          <div id="reportMeta" class="muted small"></div>
          <div class="row wrap" style="margin-top:10px; gap:10px;">
            <button id="warnUserBtn" class="btn outline small">Warn user</button>
            <button id="banUserBtn" class="btn danger small">Ban user</button>
            <button id="unbanUserBtn" class="btn outline small">Unban user</button>
            <button id="closeReportBtn" class="btn outline small">Close & delete</button>
            <button id="sendInboxBtn" class="btn primary small">Send overlay msg</button>
          </div>
        </section>

        <br>
        <section class="card glass elevate" id="userEditor" style="display:none;">
          <h3>User editor</h3>
          <div id="userMeta" class="muted small" style="margin-bottom:8px;"></div>
          <div class="grid-2">
            <label class="field">
              <span>Display name</span>
              <input id="ueDisplayName" type="text" />
            </label>
            <label class="field">
              <span>Warnings</span>
              <input id="ueWarnings" type="number" min="0" />
            </label>
            <label class="field">
              <span>Strikes</span>
              <input id="ueStrikes" type="number" min="0" />
            </label>
            <label class="field">
              <span>Ban minutes (0 = none/clear)</span>
              <input id="ueBanMinutes" type="number" min="0" />
            </label>
            <label class="field">
              <span>Last strike reason</span>
              <input id="ueLastReason" type="text" />
            </label>
            <label class="field">
              <span>Banned</span>
              <input id="ueBanned" type="checkbox" />
            </label>
          </div>
          <div class="row wrap" style="margin-top:10px; gap:10px;">
            <button id="ueSave" class="btn primary small">Save</button>
            <button id="ueClear" class="btn outline small">Clear selection</button>
          </div>
        </section>
      </section>
    </section>

    <footer class="footer global-footer">
      <small>© <span id="yearAgent"></span><span> Matīss Gromovs</span> </small>
    </footer>
  </main>
  <script>
    document.getElementById('yearAgent').textContent = new Date().getFullYear();
  </script>
  <script type="module" src="firebase.js"></script>
  <script type="module" src="auth.js"></script>
  <script type="module" src="agent.js"></script>
</body>
</html>